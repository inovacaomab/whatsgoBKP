<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">What's Go APP</title>
    <meta name="description" data-i18n="metaDescription" content="What's Go APP - Acesse facilmente seu APP de mensagens.">
    <meta name="keywords" content="What's Go, Inovação MAB, WhatsApp, Comunicação, Simples, Funcional">
    <meta name="author" content="Inovação MAB">
    <meta property="og:title" data-i18n="ogTitle" content="What's Go APP"/>
    <meta property="og:description" data-i18n="ogDescription" content="Simplifique o acesso ao seu app de mensagens com What's Go!"/>
    <meta property="og:image" content="https://example.com/thumbnail.jpg"/>
    <meta property="og:url" content="https://www.inovacaomab.com/whatsgoapp">

    <!-- PWA: manifesto, tema e ícone -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#25D366">
    <link rel="icon" href="./icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="./icons/icon-192.png">

    <!-- Seus CSS existentes -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.13/css/intlTelInput.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Scripts existentes -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.13/js/intlTelInput.min.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0YQTBMJMDF"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6742040663921517" crossorigin="anonymous"></script>
    
    <link rel="icon" type="image/x-icon" href="iconezinho.ico">
    
    <style>
        /* Estilo para o seletor de idioma */
        .language-selector {
            text-align: center;
            margin: 15px 0;
        }
        
        #languageSelect {
            padding: 8px 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 14px;
            background-color: white;
            cursor: pointer;
        }
        
        #languageSelect:hover {
            border-color: #999;
        }
        
        /* Estilo para o botão de doação */
        .donation-section {
            margin-top: 15px;
            text-align: center;
        }
        
        .donation-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
            border: none;
            cursor: pointer;
        }
        
        .donation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
            background: linear-gradient(135deg, #ee5a52, #ff6b6b);
            color: white;
            text-decoration: none;
        }
        
        .donation-btn i {
            font-size: 12px;
            animation: heartbeat 2s infinite;
        }
        
        @keyframes heartbeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Mantém os estilos existentes do seu site e apenas ajusta o container */
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Botão de instalação PWA (fixo) */
        #btn-install {
            display: none; /* mostrado apenas quando beforeinstallprompt disparar ou quando aplicável */
            position: fixed;
            right: 16px;
            bottom: 16px;
            padding: .6rem .8rem;
            border-radius: 8px;
            background: #25D366;
            color: #fff;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,.2);
            z-index: 9999;
            cursor: pointer;
        }

        /* Modal/overlay para instruções iOS */
        #a2hs-ios {
          position: fixed;
          inset: 0;
          display: none;
          align-items: center;
          justify-content: center;
          background: rgba(0,0,0,0.4);
          z-index: 10000;
        }
        .a2hs-ios-inner {
          background: #fff;
          padding: 1rem 1.25rem;
          max-width: 360px;
          border-radius: 10px;
          text-align: center;
          box-shadow: 0 6px 24px rgba(0,0,0,0.25);
          position: relative;
        }
        #a2hs-ios-close {
          position: absolute;
          right: 8px;
          top: 6px;
          border: none;
          background: transparent;
          font-size: 20px;
          cursor: pointer;
        }

        /* Acessibilidade visual */
        #btn-install:focus, #a2hs-ios-close:focus { outline: 3px solid rgba(37,211,102,0.4); outline-offset: 2px; }
    </style>
</head>
<body>
    <div class="container">
        <img src="iconeprincipal.jpg" alt="What's Go Logo" id="logo">
        <h1 id="appName">What's Go</h1>
        <input type="tel" id="phoneNumber" data-i18n-placeholder="phonePlaceholder">
        <textarea id="messageText" data-i18n-placeholder="messagePlaceholder"></textarea>
        <button onclick="openWhatsApp()" data-i18n="startChat">Iniciar Chat</button>

        <!-- Seletor de idioma movido para depois do botão -->
        <div class="language-selector">
            <select id="languageSelect" onchange="changeLanguage(this.value)">
                <option value="pt-BR">Português</option>
                <option value="en">English</option>
                <option value="es">Español</option>
                <option value="fr">Français</option>
                <option value="de">Deutsch</option>
                <option value="it">Italiano</option>
                <option value="id">Bahasa Indonesia</option>
                <option value="zh">中文</option>
                <option value="ja">日本語</option>
                <option value="ru">Русский</option>
                <option value="ar">العربية</option>
                <option value="he">עברית</option>
            </select>
        </div>

        <footer>
            <p id="developed">
                <span data-i18n="developedBy">Desenvolvido por</span> 
                <a href="https://www.inovacaomab.com">Inovação MAB</a>
            </p>
            <div class="social-links">
                <a href="https://www.youtube.com/@whatsgoapp" target="_blank" onclick="trackSocialClick('YouTube')" data-i18n-title="subscribeYoutube"><i class="fab fa-youtube"></i></a>
                <a href="https://www.linkedin.com/company/inovacao-mab/" target="_blank" onclick="trackSocialClick('LinkedIn')" data-i18n-title="followLinkedIn"><i class="fab fa-linkedin-in"></i></a>
                <a href="https://whatsapp.com/channel/0029Va5uO93FcowAHRjvWP0k" target="_blank" onclick="trackSocialClick('WhatsApp')" data-i18n-title="joinChannel"><i class="fab fa-whatsapp"></i></a>
                <br><br>
                <a href="https://play.google.com/store/apps/details?id=com.inovacaomab.whatsgo" target="_blank" onclick="trackSocialClick('Instale o APP da Play Store')" data-i18n-title="installAndroid"><i class="fab fa-google-play"></i></a>
            </div>
            <p id="glory" data-i18n="gloryMessage">A DEUS toda a Glória!</p>
            
            <!-- Botão de doação discreto -->
            <div class="donation-section">
                <a href="#" onclick="openDonation()" class="donation-btn" data-i18n-title="supportProject">
                    <i class="fas fa-heart"></i>
                    <span data-i18n="supportUs">Faça a diferença</span>
                </a>
            </div>
        </footer>
    </div>

    <!-- Botão de instalação PWA (inserido sem alterar estrutura) -->
    <button id="btn-install" aria-label="Instalar aplicativo">Instalar</button>

    <!-- Modal/overlay para instruções iOS -->
    <div id="a2hs-ios" role="dialog" aria-hidden="true">
      <div class="a2hs-ios-inner" role="document">
        <button id="a2hs-ios-close" aria-label="Fechar">×</button>
        <h3>Instalar o app</h3>
        <p>Para instalar no iPhone/iPad: toque no ícone <strong>Compartilhar</strong> (barra inferior) e escolha <strong>"Adicionar à Tela de Início"</strong>.</p>
        <img src="./icons/icon-192.png" alt="Ícone" style="width:72px;height:72px;margin-top:8px;">
      </div>
    </div>

    <!-- Dicionário de traduções -->
    <script>
        const translations = {
            'pt-BR': {
                pageTitle: "What's Go APP",
                metaDescription: "What's Go APP - Acesse facilmente seu APP de mensagens.",
                ogTitle: "What's Go APP",
                ogDescription: "Simplifique o acesso ao seu app de mensagens com What's Go!",
                phonePlaceholder: "(xx) xxxxx-xxxx",
                messagePlaceholder: "Digite sua mensagem aqui...",
                startChat: "Iniciar Chat",
                developedBy: "Desenvolvido por",
                followInstagram: "Siga nossa bio!",
                subscribeYoutube: "Se inscreva agora mesmo!",
                followLinkedIn: "Siga nossa page!",
                joinChannel: "Participe do Canal!",
                installAndroid: "Instale o APP para ANDROID!",
                gloryMessage: "A DEUS toda a Glória!",
                phoneError: "Por favor, insira um número de telefone.",
                supportUs: "Faça a diferença",
                supportProject: "Apoie o projeto com uma doação"
            },
            'en': {
                pageTitle: "What's Go APP",
                metaDescription: "What's Go APP - Easily access your messaging APP.",
                ogTitle: "What's Go APP",
                ogDescription: "Simplify access to your messaging app with What's Go!",
                phonePlaceholder: "Enter a phone number",
                messagePlaceholder: "Type your message here...",
                startChat: "Start Chat",
                developedBy: "Developed by",
                followInstagram: "Follow our bio!",
                subscribeYoutube: "Subscribe now!",
                followLinkedIn: "Follow our page!",
                joinChannel: "Join the Channel!",
                installAndroid: "Install APP for ANDROID!",
                gloryMessage: "To GOD be all the Glory!",
                phoneError: "Please enter a phone number.",
                supportUs: "Make a Difference",
                supportProject: "Support the project with a donation"
            },
            /* ... restante das traduções (mantive seu conteúdo original) ... */
        };

        // Função para detectar o idioma do navegador
        function detectLanguage() {
            const browserLang = navigator.language || navigator.userLanguage;
            const shortLang = browserLang.split('-')[0];
            if (translations[browserLang]) {
                return browserLang;
            } else if (translations[shortLang]) {
                return shortLang;
            }
            return 'pt-BR'; // Idioma padrão
        }

        // Função para atualizar todos os textos da página
        function updatePageLanguage(lang) {
            document.documentElement.lang = lang;
            const texts = translations[lang];

            // Atualiza meta tags (verifica existência antes)
            document.title = texts.pageTitle;
            const desc = document.querySelector('meta[name="description"]');
            if (desc) desc.content = texts.metaDescription;
            const ogTitle = document.querySelector('meta[property="og:title"]');
            if (ogTitle) ogTitle.content = texts.ogTitle;
            const ogDesc = document.querySelector('meta[property="og:description"]');
            if (ogDesc) ogDesc.content = texts.ogDescription;

            // Atualiza placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                element.placeholder = texts[key] || '';
            });

            // Atualiza textos
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                element.textContent = texts[key] || '';
            });

            // Atualiza títulos
            document.querySelectorAll('[data-i18n-title]').forEach(element => {
                const key = element.getAttribute('data-i18n-title');
                element.title = texts[key] || '';
            });
        }

        // Função para mudar o idioma
        function changeLanguage(lang) {
            updatePageLanguage(lang);
            localStorage.setItem('preferredLanguage', lang);
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Configuração do telefone internacional
            var phoneNumberInput = document.querySelector('#phoneNumber');
            var iti = window.intlTelInput(phoneNumberInput, {
                initialCountry: 'br',
                preferredCountries: ['br', 'us', 'id'],
                separateDialCode: true,
                utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.13/js/utils.js"
            });

            // Configuração do idioma
            const savedLanguage = localStorage.getItem('preferredLanguage') || detectLanguage();
            if (document.querySelector('#languageSelect')) document.querySelector('#languageSelect').value = savedLanguage;
            updatePageLanguage(savedLanguage);

            // Função para abrir WhatsApp
            window.openWhatsApp = function() {
                var message = encodeURIComponent(document.querySelector('#messageText').value);
                var phoneNumber = phoneNumberInput.value.replace(/\D/g,'');
                var countryData = iti.getSelectedCountryData();
                var dialCode = countryData.dialCode;
                phoneNumber = '+' + dialCode + phoneNumber;
                
                if (phoneNumber) {
                    var url = `https://wa.me/${phoneNumber}`;
                    if (message) {
                        url += `?text=${message}`;
                    }
                    window.open(url, '_blank');
                    if (typeof gtag === 'function') gtag('event', 'click', {
                        'event_category': 'WhatsApp Chat',
                        'event_label': 'Initiate Chat',
                        'value': phoneNumber
                    });
                } else {
                    const lang = document.documentElement.lang || 'pt-BR';
                    alert(translations[lang].phoneError);
                }
            }
        });

        // Google Analytics
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-0YQTBMJMDF');

        // Função para rastrear cliques em redes sociais
        function trackSocialClick(serviceName) {
            if (typeof gtag === 'function') gtag('event', 'click', {
                'event_category': 'Social Media',
                'event_label': serviceName
            });
        }

        // Função para abrir link de doação
        function openDonation() {
            const donationLink = 'https://www.paypal.com/donate/?hosted_button_id=FAX6J82B2ZQNN'; // Exemplo
            window.open(donationLink, '_blank');
            if (typeof gtag === 'function') gtag('event', 'click', {
                'event_category': 'Donation',
                'event_label': 'Support Button'
            });
        }
    </script>

    <!-- Registro do Service Worker (inline para facilitar deploy) -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', async () => {
          try {
            // registra sw relativo para funcionar em GitHub Pages/project pages
            const reg = await navigator.serviceWorker.register('./sw.js');
            console.log('Service Worker registrado:', reg);
          } catch (err) {
            console.error('Erro ao registrar Service Worker:', err);
          }
        });
      }
    </script>

    <!-- Install handler (controle do botão e modal iOS) -->
    <script>
      (function() {
        const installBtn = document.getElementById('btn-install');
        const iosModal = document.getElementById('a2hs-ios');
        const iosClose = document.getElementById('a2hs-ios-close');

        let deferredPrompt = null;

        function isAppInstalled() {
          return (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches)
            || window.navigator.standalone === true;
        }

        function isIos() {
          return /iphone|ipad|ipod/i.test(window.navigator.userAgent);
        }

        function updateInstallButton() {
          if (!installBtn) return;
          if (isAppInstalled()) {
            installBtn.style.display = 'none';
            installBtn.setAttribute('aria-hidden', 'true');
          } else {
            // if beforeinstallprompt hasn't fired yet, we still keep the button hidden
            // it will be shown when beforeinstallprompt fires or for iOS fallback
            if (deferredPrompt) {
              installBtn.style.display = 'inline-block';
              installBtn.removeAttribute('aria-hidden');
            } else {
              // For iOS show button so users can get instructions
              if (isIos()) {
                installBtn.style.display = 'inline-block';
                installBtn.removeAttribute('aria-hidden');
              } else {
                // keep hidden until prompt available
                installBtn.style.display = 'none';
              }
            }
          }
        }

        window.addEventListener('beforeinstallprompt', (e) => {
          e.preventDefault();
          deferredPrompt = e;
          if (installBtn) {
            installBtn.style.display = 'inline-block';
            installBtn.removeAttribute('aria-hidden');
          }
          if (typeof gtag === 'function') gtag('event','pwa_prompt_available');
        });

        window.addEventListener('appinstalled', () => {
          console.log('PWA instalado');
          if (typeof gtag === 'function') gtag('event','pwa_installed');
          updateInstallButton();
        });

        if (installBtn) {
          installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
              deferredPrompt.prompt();
              const choice = await deferredPrompt.userChoice;
              if (typeof gtag === 'function') gtag('event','pwa_install_choice', { outcome: choice.outcome });
              deferredPrompt = null;
              updateInstallButton();
              return;
            }

            if (isIos()) {
              if (iosModal) {
                iosModal.style.display = 'flex';
                iosModal.setAttribute('aria-hidden','false');
                // move focus to close button for accessibility
                if (iosClose) iosClose.focus();
              } else {
                alert('Para instalar: toque em Compartilhar → Adicionar à Tela de Início.');
              }
              return;
            }

            // Fallback generic instruction
            alert('Para instalar este app, verifique o menu do seu navegador e escolha "Adicionar à tela inicial" ou "Instalar".');
          });
        }

        if (iosClose) {
          iosClose.addEventListener('click', () => {
            if (iosModal) {
              iosModal.style.display = 'none';
              iosModal.setAttribute('aria-hidden','true');
              if (installBtn) installBtn.focus();
            }
          });
        }

        document.addEventListener('visibilitychange', updateInstallButton);
        window.addEventListener('load', updateInstallButton);
        document.addEventListener('DOMContentLoaded', updateInstallButton);
      })();
    </script>
</body>
</html>
